<% if node[:gearman][:env] =="true" -%>

identifier=<%= node['gearman']['hostgroup'] %>_worker
debug=2
logmode=automatic
logfile=/var/log/mod-gearman/worker.log
server=<%= node['gearman']['server-name'] %>
key=<%= node['gearman']['key'] %>
hosts=yes
services=yes
eventhandler=yes
hostgroups=<%= node['gearman']['hostgroup'] %>
encryption=yes
job_timeout=60
max-age=600
min-worker=1
max-worker=20
p1_file=<%= node['gearman']['idfile'] %>
<% end -%>

<% if node[:gearman][:env] =="false" -%>
<% @hostgroups.sort.each do |h| %>
worker for hostgroup <%= h %>
identifier=<%= h %>_worker
debug=2
logmode=automatic
logfile=/var/log/mod-gearman/worker.log
server=<%= node['gearman']['server-name'] %>
key=<%= node['gearman']['key'] %>
hosts=yes
services=yes
eventhandler=yes
hostgroups=<%= h %>
encryption=yes
job_timeout=60
max-age=600
min-worker=1
max-worker=20
p1_file=<%= node['gearman']['idfile'] %>

<% end %>
<% end -%>
